import{r as i,c as e,h as n,g as t}from"./p-3aa90682.js";import{g as o,u as r}from"./p-89f98d30.js";class a extends Error{constructor(i,e,n="INVALID",t=null){super(i),this.name="PNFileUploadError",this.element=e,this.code=n,this.data=t}}const l=class{constructor(n){i(this,n),this.filesAdded=e(this,"filesAdded",7),this.update=e(this,"update",7),this.fileuploaderror=e(this,"fileuploaderror",7),this.valid=e(this,"valid",7),this.uploadFile=e(this,"uploadFile",7),this.uploadCancelled=e(this,"uploadCancelled",7),this.uploadCompleted=e(this,"uploadCompleted",7),this.triggerElements=[],this.renders=0,this.maxSize="",this.limit=1,this.invalid=!1,this.files=[],this.maxSizeInBytes=0}componentWillLoad(){this._initTriggerElements(),this._setDefaultValues(),this.initMaxBytes(),this.disabled?this.hostElement.classList.add("disabled"):this.hostElement.classList.remove("disabled")}componentWillUpdate(){this.invalid?this.hostElement.classList.add("invalid"):this.hostElement.classList.remove("invalid"),this.disabled?this.hostElement.classList.add("disabled"):this.hostElement.classList.remove("disabled")}initMaxBytes(){this.maxSizeInBytes=o(this.maxSize)}componentDidLoad(){this.fileInputElement=this.hostElement.querySelector(".pn-file-upload-input"),this.fileInputElement.addEventListener("change",this._onAddFile.bind(this))}_setDefaultValues(){this.limit>1&&(this.multiple=!0)}_initTriggerElements(){const i=this;this.triggerElements=Array.from(this.hostElement.querySelectorAll(".pn-open-file-explorer")),this.triggerElements.forEach((function(e){"1"!==e.dataset.canOpen&&(e.addEventListener("click",i.openFileExplorer.bind(i)),e.dataset.canOpen="1")}))}_addFilesFromFileList(i){if(this.disabled||this.invalid)return;const e=this,n=Array.from(i),t=[];if(this.multiple)n.forEach((function(i){t.push(e._addFile(i))}));else{const i=n[0];1===this.limit?(this.files=[],t.push(this._addFile(i))):t.push(this._addFile(i))}Promise.all(t).then((function(){e.filesAdded.emit(e.files),e._isNotGreaterThanLimit(),e._checkValidity(),e._emitUpdateEvent(),e.fileInputElement.value=""}))}_onAddFile(){return this._addFilesFromFileList(this.fileInputElement.files)}_onDragOverFile(i){i.preventDefault(),i.stopPropagation(),this.hostElement.classList.add("hover")}_onDragLeaveFile(i){i.preventDefault(),i.stopPropagation(),this.hostElement.classList.remove("hover")}_onDropFile(i){i.preventDefault(),i.stopPropagation(),this.hostElement.classList.remove("hover"),this._addFilesFromFileList(i.dataTransfer.files)}_validateFileType(i){const e=this.accept?this.accept.split(","):[];if(e.length){let n=!1;for(const t of e){const e=t.trim().toLowerCase(),o=/^\w+\/[a-z\.\-]+$/i,r=i.filename.substr(i.filename.lastIndexOf(".")).toLowerCase();if(o.test(e)&&i.contentType===e){n=!0;break}if(r===e){n=!0;break}}if(!n){const e=new a("Invalid file type.",this.hostElement,"INVALID_FILE_TYPE",i);throw this.invalid=!0,this.fileuploaderror.emit(e),e}}}_validateFileSize(i){if(this.maxSizeInBytes>0&&i.filesize>this.maxSizeInBytes){const e=new a(`You can only add up to ${this.maxSize}.`,this.hostElement,"MAX_FILE_SIZE",i);throw this.invalid=!0,this.fileuploaderror.emit(e),e}}_validateLimit(){if(this.limit&&this.files.length>this.limit){const i=new a(`You can only add up to ${this.limit} files.`,this.hostElement,"MAX_LIMIT",this.files);throw this.invalid=!0,this.fileuploaderror.emit(i),i}}_isNotGreaterThanLimit(){try{return this._validateLimit(),!0}catch(i){return!1}}_checkValidity(){return this.invalid||this.valid.emit(this),this._initTriggerElements(),!this.invalid}_createBase64FromFile(i){return new Promise((function(e,n){const t=new FileReader;t.onload=function(){e(t.result)},t.onerror=function(i){n(i)},t.onabort=function(){n("ABORTED")},t.readAsDataURL(i)}))}_addFile(i){const e=this;return this._createBase64FromFile(i).then((function(n){const t=n.split(","),o=t[1],l=t[0].split(":")[1].split(";")[0],s=new XMLHttpRequest,p={uuid:r(),filename:i.name,filesize:i.size,progress:0,status:"queue",base64:o,contentType:l,error:null,errorMessage:"",file:i,xhr:s};try{e._validateFileSize(p),e._validateFileType(p)}catch(d){p.error=d,p.progress=100,p.status="error"}return p.xhrPromise=function(){return new Promise((function(i,n){s.responseType="json",s.addEventListener("progress",(function(i){i.lengthComputable?(p.progress=i.loaded/i.total*100,e.updateFile(p)):(p.progress=100,e.updateFile(p))})),s.addEventListener("load",(function(e){i(e.target.response)})),s.addEventListener("error",(function(i){p.error=i,p.errorMessage="There was an error uploading your file, please try again",e.updateFile(p);const t=new a("There was an error uploading your file, please try again",e.hostElement,"UPLOAD_SERVER_ERROR",p);e.fileuploaderror.emit(t),n(i)}))}))},e.files=[...e.files,p],p}))}_removeFile(i,e){return function(n){n.preventDefault(),e.removeFile(i)}}_emitUpdateEvent(){this.update.emit({files:this.files,element:this})}openFileExplorer(i){i.preventDefault(),this.invalid||this.disabled||this.fileInputElement.click()}async startUpload(){const i=this;if(!i.files.length)return;i.files=i.files.map((function(e,n){return"queue"===e.status&&(e.status="start",i.uploadFile.emit({file:e,index:n,uploader:i})),e}));const e=i.files.map((function(i){return i.xhrPromise().catch((function(){}))}));Promise.all(e).then((function(e){const n=e.filter((function(i){return i}));i.uploadCompleted.emit(n)}))}async clearUpload(){this.files=[],this.fileInputElement.value="",this.invalid=!1,this.filesAdded.emit([])}async removeFile(i){let e=!0;const n=[];for(const o in this.files){const r=this.files[o];if(r.filename)if(r.uuid!==i.uuid){try{this._validateFileSize(r),this._validateFileType(r),e=!0}catch(t){e=!1,r.error=t,r.progress=100,r.status="error"}n.push(r)}else"start"===r.status&&(r.xhr.abort(),this.uploadCancelled.emit(r))}this.filesAdded.emit(n),this.files=n,this.invalid=!e||!this._isNotGreaterThanLimit(),this._checkValidity(),this._emitUpdateEvent()}async updateFile(i,e=null){let n=this.files;if(null===e)for(const t in n)if(n[t].uuid===i.uuid){e=t;break}n[e]&&(i.progress>=100?(i.progress=100,i.status="completed"):i.progress<0&&(i.status="start",i.progress=0),i.error&&(i.progress=100,i.status="error",i.errorMessage=i.errorMessage||"There was an error uploading your file, please try again"),n[e]=i),this.files=n,this._forceRender()}_forceRender(){this.renders=this.renders+1}render(){return n("div",{class:"pn-file-upload-container"},n("div",{class:"pn-dropzone-container"},n("div",{class:"pn-dropzone-inner"},n("div",{class:"pn-file-upload-dropzone",onDragOver:this._onDragOverFile.bind(this),onDragLeave:this._onDragLeaveFile.bind(this),onDrop:this._onDropFile.bind(this)},n("div",{class:"default-message-container"},n("pn-icon",this.disabled||this.invalid?{class:"pn-file-upload-dropzone-icon",symbol:"disabled",color:"grey-06-rock"}:{class:"pn-file-upload-dropzone-icon",symbol:"upload",color:"grey-06-rock"}),n("slot",null))))),n("section",{class:"files-list"},this.files.map((i=>n("div",{class:"files-list-item-container"},n("div",{class:"files-list-item"},n("pn-progress-bar",{label:i.filename,"show-spinner":this.showSpinner&&i.progress<100&&"start"===i.status,progress:i.progress,color:"error"===i.status?"error":"default",size:"small",width:"100%"}),n("div",{class:"icon-button"}),n("pn-icon",{symbol:"minus-circle",color:"grey-05-battleship",onClick:this._removeFile(i,this)})),i.error?n("div",{class:"files-list-item-error"},i.errorMessage||i.error.message):null)))),n("input",{type:"file",name:"pnFileUpload[]",class:"pn-file-upload-input",multiple:this.multiple,accept:this.accept}))}get hostElement(){return t(this)}static get watchers(){return{maxSize:["initMaxBytes"]}}};l.style='pn-file-upload.hover .pn-file-upload-container .pn-dropzone-container{background-color:#e0f8ff}pn-file-upload.invalid .pn-file-upload-container .pn-dropzone-container,pn-file-upload.disabled .pn-file-upload-container .pn-dropzone-container{background-color:#d3cecb}pn-file-upload.invalid .pn-file-upload-container .pn-dropzone-container,pn-file-upload.invalid .pn-file-upload-container .pn-dropzone-container:after,pn-file-upload.disabled .pn-file-upload-container .pn-dropzone-container,pn-file-upload.disabled .pn-file-upload-container .pn-dropzone-container:after{background-image:-webkit-gradient(linear, left top, right top, color-stop(50%, #969087), color-stop(0%, transparent));background-image:linear-gradient(to right, #969087 50%, transparent 0%)}pn-file-upload.invalid .pn-file-upload-container .pn-dropzone-container .pn-dropzone-inner,pn-file-upload.invalid .pn-file-upload-container .pn-dropzone-container .pn-dropzone-inner:after,pn-file-upload.disabled .pn-file-upload-container .pn-dropzone-container .pn-dropzone-inner,pn-file-upload.disabled .pn-file-upload-container .pn-dropzone-container .pn-dropzone-inner:after{background-image:-webkit-gradient(linear, left top, left bottom, color-stop(50%, #969087), color-stop(0%, transparent));background-image:linear-gradient(to bottom, #969087 50%, transparent 0%)}pn-file-upload.invalid .pn-file-upload-container .pn-dropzone-container a,pn-file-upload.disabled .pn-file-upload-container .pn-dropzone-container a{cursor:default}pn-file-upload.invalid .pn-file-upload-container .pn-dropzone-container:hover,pn-file-upload.disabled .pn-file-upload-container .pn-dropzone-container:hover{background-color:#d3cecb}pn-file-upload.invalid .pn-file-upload-container .pn-dropzone-container .headline a,pn-file-upload.disabled .pn-file-upload-container .pn-dropzone-container .headline a{color:#5e554a}pn-file-upload .pn-file-upload-input{display:none}pn-file-upload .pn-file-upload-container .pn-dropzone-container{text-align:center;position:relative;background-image:-webkit-gradient(linear, left top, right top, color-stop(50%, #00a0d6), color-stop(0%, transparent));background-image:linear-gradient(to right, #00a0d6 50%, transparent 0%);background-position:top;background-size:16px 1px;background-repeat:repeat-x;background-color:#ffffff}pn-file-upload .pn-file-upload-container .pn-dropzone-container:after{content:" ";position:absolute;width:100%;height:1px;bottom:0;left:0;background-image:-webkit-gradient(linear, left top, right top, color-stop(50%, #00a0d6), color-stop(0%, transparent));background-image:linear-gradient(to right, #00a0d6 50%, transparent 0%);background-position:bottom;background-size:16px 1px;background-repeat:repeat-x}pn-file-upload .pn-file-upload-container .pn-dropzone-container:hover{background-color:#e0f8ff}pn-file-upload .pn-file-upload-container .pn-dropzone-container .pn-dropzone-inner{padding:25px 60px;position:relative;background-image:-webkit-gradient(linear, left top, left bottom, color-stop(50%, #00a0d6), color-stop(0%, transparent));background-image:linear-gradient(to bottom, #00a0d6 50%, transparent 0%);background-position:left;background-size:1px 16px;background-repeat:repeat-y}pn-file-upload .pn-file-upload-container .pn-dropzone-container .pn-dropzone-inner:after{content:" ";position:absolute;width:1px;height:100%;top:0;right:0;background-image:-webkit-gradient(linear, left top, left bottom, color-stop(50%, #00a0d6), color-stop(0%, transparent));background-image:linear-gradient(to bottom, #00a0d6 50%, transparent 0%);background-position:right;background-size:1px 16px;background-repeat:repeat-y}pn-file-upload .pn-file-upload-container .pn-dropzone-container .headline{color:#969087;font-size:16px;font-weight:300;line-height:20px;text-align:center;margin-bottom:8px}pn-file-upload .pn-file-upload-container .pn-dropzone-container .headline a{color:#005d92}pn-file-upload .pn-file-upload-container .pn-dropzone-container .description{color:#969087;font-size:12px;font-weight:300;line-height:16px;margin-bottom:0}pn-file-upload .files-list .files-list-item{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-wrap:nowrap;flex-wrap:nowrap;-ms-flex-pack:justify;justify-content:space-between;-ms-flex-align:start;align-items:flex-start}pn-file-upload .files-list .files-list-item>pn-progress-bar{margin-right:10px;-ms-flex:1;flex:1}pn-file-upload .files-list .files-list-item>pn-icon{margin-top:34px;cursor:pointer}pn-file-upload .files-list .files-list-item-error{color:#5e554a;font-size:14px;font-weight:300;line-height:20px}';export{l as pn_file_upload}