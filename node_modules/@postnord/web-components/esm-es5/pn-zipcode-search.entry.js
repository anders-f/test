var __awaiter=this&&this.__awaiter||function(e,t,r,n){function a(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,i){function o(e){try{l(n.next(e))}catch(t){i(t)}}function s(e){try{l(n["throw"](e))}catch(t){i(t)}}function l(e){e.done?r(e.value):a(e.value).then(o,s)}l((n=n.apply(e,t||[])).next())}))};var __generator=this&&this.__generator||function(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol==="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(e){return function(t){return l([e,t])}}function l(o){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,a&&(i=o[0]&2?a["return"]:o[0]?a["throw"]||((i=a["return"])&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;if(a=0,i)o=[o[0]&2,i.value];switch(o[0]){case 0:case 1:i=o;break;case 4:r.label++;return{value:o[1],done:false};case 5:r.label++;a=o[1];o=[0];continue;case 7:o=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(o[0]===6||o[0]===2)){r=0;continue}if(o[0]===3&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(o[0]===6&&r.label<i[1]){r.label=i[1];i=o;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(o);break}if(i[2])r.ops.pop();r.trys.pop();continue}o=t.call(e,r)}catch(s){o=[6,s];a=0}finally{n=i=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:true}}};import{r as registerInstance,c as createEvent,h,a as Host}from"./index-970cd8af.js";var translations={CLOSEST_DELIVERY_DATE:{da:"Closest delivery date:",en:"Closest delivery date:",fi:"Closest delivery date:",no:"Closest delivery date:",sv:"Nästa utdelningsdag:"},NEXT_DELIVERY_DATE:{da:"Next delivery date:",en:"Next delivery date:",fi:"Next delivery date:",no:"Next delivery date:",sv:"Kommande utdelningsdag:"},ZIP_CODE:{da:"Zip code:",en:"Zip code:",fi:"Zip code:",no:"Zip code:",sv:"Postnummer:"},VALIDATION_ERROR_MESSAGE:{da:"Zip code not valid",en:"Zip code not valid",fi:"Zip code not valid",no:"Zip code not valid",sv:"Postnumret är inte giltigt"},SERVER_ERROR_MESSAGE:{da:"Could not find zip code",en:"Could not find zip code",fi:"Could not find zip code",no:"Could not find zip code",sv:"Kan inte hitta postnumret"},PLACEHOLDER_TEXT:{da:"Search for a zip code",en:"Search for a zip code",fi:"Search for a zip code",no:"Search for a zip code",sv:"Sök på ett postnummer"}};var pnZipcodeSearchCss="pn-zipcode-search{display:block;color:#5e554a}pn-zipcode-search .search-results{margin-top:1em;padding:0.5em}pn-zipcode-search .search-results>h3,pn-zipcode-search .search-results h2{font-weight:normal}pn-zipcode-search .text-row{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center}pn-zipcode-search .text-row+.text-row{margin-top:1em}pn-zipcode-search .text-row>*+*{margin-left:0.25em}pn-zipcode-search .error-text{color:#a70707;padding:0.5em 1em}pn-zipcode-search pn-search-field{width:100%}@media screen and (max-width: 30em){pn-zipcode-search .text-row:nth-child(-n+2){-ms-flex-direction:column;flex-direction:column;-ms-flex-align:unset;align-items:unset}pn-zipcode-search .text-row:nth-child(-n+2) .delivery-date{margin-left:auto;margin-top:0.25em}}";var PnZipCodeSearch=function(){function e(e){registerInstance(this,e);this.searchsuccessful=createEvent(this,"searchsuccessful",7);this.marketwebLanguage="";this.language="sv";this.loading=false;this.error=false;this.errorMessage="";this.showResult=false;this.zipCodeSearchResult={delivery:"",upcoming:"",city:"",postalCode:""}}e.prototype.componentWillLoad=function(){var e=this;var t=window.pnTopbar;if(t){this.init()}else{window.addEventListener("topbarLoaded",(function(){e.init()}))}};e.prototype.init=function(){var e=this;var t=window.pnTopbar;if(t){this.language=t.language;t.onChangeLanguage=function(t){e.language=t}}};e.prototype.isEmpty=function(e){var t=!e;if(t){return true}var r=e.trim().length===0;if(r){return true}else{return false}};e.prototype.getTranslation=function(e,t){for(var r=0,n=Object.entries(translations);r<n.length;r++){var a=n[r],i=a[0],o=a[1];if(i===e.toUpperCase()){var s=translations[i].en;for(var l=0,c=Object.entries(o);l<c.length;l++){var h=c[l],d=h[0],u=h[1];if(d===t.toLowerCase()){if(this.isEmpty(u)){return s}else{return u}}}return s}}return e};e.prototype.handleSearch=function(e){var t=this.validateZipCode(e.detail);if(t.error){this.error=true;this.errorMessage="VALIDATION_ERROR_MESSAGE";return}this.zipCodeSearch(t.value)};e.prototype.zipCodeSearch=function(e){return __awaiter(this,void 0,void 0,(function(){var t=this;return __generator(this,(function(r){switch(r.label){case 0:this.loading=true;return[4,fetch("https://portal.postnord.com/api/sendoutarrival/closest?postalCode=".concat(e)).then((function(e){return e.json()})).then((function(e){t.error=false;t.loading=false;t.showResult=true;t.zipCodeSearchResult=e;t.searchsuccessful.emit(true)})).catch((function(){t.error=true;t.errorMessage="SERVER_ERROR_MESSAGE";t.loading=false;t.searchsuccessful.emit(false)}))];case 1:r.sent();return[2]}}))}))};e.prototype.validateZipCode=function(e){var t=e?e.replace(/[ -]/gi,""):"";var r=new RegExp(/\D+/);var n=r.test(t)||t.length!==5;return{error:n,value:t}};e.prototype.renderSearchResult=function(){if(!this.loading&&!this.error&&this.showResult){return h("div",{class:"search-results"},h("div",{class:"text-row"},h("h3",null,this.getTranslation("CLOSEST_DELIVERY_DATE",this.marketwebLanguage||this.language)," "),h("h2",{class:"delivery-date"},this.zipCodeSearchResult.delivery)),h("div",{class:"text-row"},h("h3",null,this.getTranslation("NEXT_DELIVERY_DATE",this.marketwebLanguage||this.language)," "),h("h2",{class:"delivery-date"},this.zipCodeSearchResult.upcoming)),h("div",{class:"text-row"},h("h3",null,this.getTranslation("ZIP_CODE",this.marketwebLanguage||this.language)),h("h2",null," ",this.zipCodeSearchResult.postalCode)),h("h3",null,this.zipCodeSearchResult.city))}};e.prototype.renderErrorMessage=function(){if(this.error&&!this.loading){return h("p",{class:"error-text pn-tiny"},this.getTranslation(this.errorMessage,this.marketwebLanguage||this.language))}};e.prototype.render=function(){var e=this;return h(Host,null,h("pn-search-field",{loading:this.loading,button:"none",placeholder:this.getTranslation("PLACEHOLDER_TEXT",this.marketwebLanguage||this.language),onSearch:function(t){return e.handleSearch(t)}}),this.renderSearchResult(),this.renderErrorMessage())};return e}();PnZipCodeSearch.style=pnZipcodeSearchCss;export{PnZipCodeSearch as pn_zipcode_search};